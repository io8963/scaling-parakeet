/* NEW: 全局 Box-Sizing 修复，防止 Padding 导致的溢出问题 */
*, *::before, *::after {
    box-sizing: border-box;
}

/* C. 主题色定义 */
:root {
    --color-primary: #00796b; /* 鲜绿色 */
    --color-primary-light: #e0f2f1; /* 浅绿色 */
    --color-link-dark: #80cbc4; /* 暗色模式下的链接颜色 */
    
    /* MODIFIED: 核心通用变量定义 - 默认使用浅色值 */
    --color-text: #333; /* 浅色模式文本 - 作为通用文本色 */
    --color-background: #f7f7f7; /* 通用背景色，默认浅色 */
    --color-card: #ffffff; /* 通用卡片背景，默认浅色 */
    --color-border: #eee; /* 通用边框颜色，默认浅色 */
    --shadow: 0 2px 5px rgba(0,0,0,0.05); /* 通用阴影，默认浅色 */
    
    --color-text-dark: #e0e0e0; /* 深色模式文本 */
    --color-background-light: #f7f7f7; /* 浅灰底色增强卡片效果 */
    --color-background-dark: #1a1a1a; /* 深色背景 */
    --color-card-light: #ffffff; /* 浅色卡片背景 */
    --color-card-dark: #2b2b2b; /* 深色卡片背景 */
    --color-border-light: #eee;
    --color-border-dark: #444;
    --shadow-light: 0 2px 5px rgba(0,0,0,0.05); /* 柔和阴影 - 减小 */
    --shadow-hover: 0 4px 10px rgba(0,0,0,0.1); /* 提升阴影 - 减小 */
    --shadow-dark: 0 2px 5px rgba(0,0,0,0.3); /* 暗色柔和阴影 */
    --shadow-dark-hover: 0 4px 10px rgba(0,0,0,0.5); /* 暗色提升阴影 */
    --color-nav-active-bg-light: var(--color-primary); /* 导航活动背景 */
    --color-nav-active-text-light: white; /* 导航活动文本 */
    --color-nav-active-bg-dark: var(--color-link-dark);
    --color-nav-active-text-dark: var(--color-card-dark);
    /* NEW READABILITY 2.1: Blockquote Backgrounds */
    --color-quote-light: rgba(0, 121, 107, 0.04); /* 4% primary tint */
    --color-quote-dark: rgba(128, 203, 196, 0.1) ; /* 10% dark link tint */
    /* NEW: 表格斑马线颜色 */
    --color-table-stripe-light: #fcfcfc;
    --color-table-stripe-dark: #3a3a3a;
    
    /* NEW FIX: 固定元素颜色变量 (Default: Light Mode) */
    --color-code-background: #f5f5f5; /* 代码块背景 */
    --color-inline-code-background: #eee; /* 行内代码背景 */
    --color-inline-code-text: #cc542e; /* 行内代码文字 */
    --color-scrollbar-thumb: #ccc; /* 滚动条滑块 */

    /* NEW UX SUGGESTION 2: 引用块文字颜色变量 */
    --color-quote-text-light: #4c4c4c;
    /* 修正建议 1: 确保深色模式下引用块文字颜色有定义和值 */ 
    --color-quote-text-dark: #b0b0b0; /* 调暗以提高深色背景对比度 */
    
    /* NEW UX SUGGESTION 4: TOC 激活背景色 */
    --color-toc-active-bg-light: var(--color-primary-light);
    --color-toc-active-bg-dark: #3a3a3a;

    /* NEW UX SUGGESTION 5: 文章头部信息区背景色 */
    --color-header-info-bg-light: var(--color-background-light);
    --color-header-info-bg-dark: #222222;

    /* NEW UX SUGGESTION 6: 标签徽章颜色 */
    --color-tag-bg-light: #f0f0f0;
    --color-tag-text-light: #555;
    --color-tag-bg-dark: #444;
    --color-tag-text-dark: #ccc;

    /* NEW UX SUGGESTION 2.2: Callout/Tip Colors (Light Mode) */
    --color-tip-bg-light: #e8f5e9; /* Light Green */
    --color-tip-text-light: #2e7d32; /* Dark Green */
    --color-warning-bg-light: #fff8e1; /* Light Yellow */
    --color-warning-text-light: #f57f17; /* Dark Yellow */
    --color-danger-bg-light: #ffebee; /* Light Red */
    --color-danger-text-light: #c62828; /* Dark Red */
    --color-callout-border-light: #ccc;
    
    /* NEW UX SUGGESTION 2.2: Callout/Tip Colors (Dark Mode) */
    --color-tip-bg-dark: #223623;
    --color-tip-text-dark: #a5d6a7;
    --color-warning-bg-dark: #403a22;
    --color-warning-text-dark: #ffd54f;
    --color-danger-bg-dark: #3b2020;
    --color-danger-text-dark: #e57373;
}

/* D. 自动深色模式切换：使用 prefers-color-scheme (NEW FIX) */
@media (prefers-color-scheme: dark) {
    :root {
        /* 核心主题色切换：将深色值赋给通用变量 */
        --color-text: var(--color-text-dark); 
        --color-background: var(--color-background-dark); 
        --color-card: var(--color-card-dark); 
        --color-border: var(--color-border-dark); 
        --shadow: var(--shadow-dark); 
        --shadow-hover: var(--shadow-dark-hover); 
        
        /* 特殊元素颜色切换 */
        --color-quote: var(--color-quote-dark); 
        
        /* NEW FIX: 定义深色模式下的固定元素颜色 */
        --color-code-background: #2b2b2b; 
        --color-inline-code-background: #3a3a3a; 
        --color-inline-code-text: var(--color-link-dark); 
        --color-scrollbar-thumb: #555; 
        
        /* 优化点 2: 移除冗余赋值，避免变量混淆 */
        /* --color-quote-text-light: var(--color-quote-text-dark); */ 

        /* NEW UX SUGGESTION 4: TOC 激活背景色 */
        --color-toc-active-bg-light: var(--color-toc-active-bg-dark);
        
        /* NEW UX SUGGESTION 5: 文章头部信息区背景色 */
        --color-header-info-bg-light: var(--color-header-info-bg-dark);

        /* NEW UX SUGGESTION 6: 标签徽章颜色 */
        --color-tag-bg-light: var(--color-tag-bg-dark);
        --color-tag-text-light: var(--color-tag-text-dark);

        /* NEW UX SUGGESTION 2.2: Callout/Tip Colors Switch */
        --color-tip-bg-light: var(--color-tip-bg-dark);
        --color-tip-text-light: var(--color-tip-text-dark);
        --color-warning-bg-light: var(--color-warning-bg-dark);
        --color-warning-text-light: var(--color-warning-text-dark);
        --color-danger-bg-light: var(--color-danger-bg-dark);
        --color-danger-text-light: var(--color-danger-text-dark);
        --color-callout-border-light: var(--color-border-dark);
    }
    
    /* MODIFIED: 头部导航栏深色模式适配和模糊效果 (解决问题 2 和 8) */
    header {
        /* 优化建议 1: 启用背景模糊 */
        -webkit-backdrop-filter: blur(8px); 
        backdrop-filter: blur(8px);
        /* 深色模式下的背景和边框 */
        background-color: rgba(43, 43, 43, 0.95); /* 使用略透明的卡片背景 */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.4);
        /* 头部圆角已在 base header 中定义 */
    }
    nav a {
        color: var(--color-text-dark); 
    }
    nav a:hover, nav a.active-nav-link {
        background-color: var(--color-link-dark);
        color: var(--color-card-dark); 
        box-shadow: 0 2px 5px rgba(128, 203, 196, 0.3); /* 暗色阴影效果 */
    }
    nav a.active-nav-link {
        /* 确保激活态悬停时不改变颜色 */
        background-color: var(--color-link-dark);
    }
    
    /* MODIFIED: 确保 body 使用变量 */
    body {
        background-color: var(--color-background);
        color: var(--color-text);
    }
    
    /* NEW FIX: 确保链接和引用块在深色模式下的颜色调整 */
    a:link, a:visited { 
        color: var(--color-link-dark); /* 非文章内容链接使用 link-dark */
    }
    a:hover {
        color: var(--color-primary); 
        text-decoration: underline;
    }

    /* 文章内链接颜色 */
    .post-content a:link, .post-content a:visited {
        color: var(--color-link-dark); /* 文章内链接使用 link-dark */
        border-bottom: 1px dotted var(--color-link-dark); 
    }
    .post-content a:hover {
        color: var(--color-primary); /* 悬停使用 primary */
        border-bottom: 1px solid var(--color-primary); 
    }
    
    /* 引用块的文字颜色切换 */
    blockquote {
        /* 优化点 2: 使用深色模式下设置的引用块文字颜色 */
        color: var(--color-quote-text-dark); 
    }

    /* 修正建议 2: 为深色模式下的图片添加柔和边框和阴影 */
    .post-content img {
        border: 1px solid var(--color-border-dark);
        background-color: var(--color-card-dark);
        box-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }
    .post-content img:hover {
        box-shadow: 0 4px 15px rgba(0,0,0,0.6); 
    }
    
    /* NEW FIX: 优化水平分割线在深色模式下的显示 */
    .post-content hr {
        border-top: 1px solid var(--color-border-dark); 
        border-bottom: 1px solid var(--color-card-dark); 
    }
    
    /* NEW ADVANCED READABILITY 5: 强调内容美化 (Dark Mode) */
    .post-content strong {
        color: var(--color-link-dark); 
    }
    .post-content em {
        color: #ffb74d; /* 浅橙色，高对比度 */
    }
    
    /* NEW: 表格深色模式适配 */
    .post-content tr:nth-child(even) {
        background-color: var(--color-table-stripe-dark); 
    }
    .post-content th {
        background-color: var(--color-background-dark);
        color: var(--color-link-dark);
    }
    
    /* NEW: 深色模式下页脚构建信息颜色 */
    .build-info span {
        color: #777; 
    }
    
    /* NEW UX SUGGESTION 3: 确保图片说明在深色模式下的颜色 */
    .post-content figcaption {
        color: #aaa;
    }
    
    /* NEW: 深色模式下的标签徽章颜色和阴影 */
    .tag-badge {
        background-color: var(--color-tag-bg-dark);
        color: var(--color-tag-text-dark);
        box-shadow: inset 0 1px 3px rgba(0,0,0,0.5); /* 柔和内嵌阴影 */
    }
    .tag-badge:hover {
        background-color: var(--color-primary);
        color: white;
        transform: translateY(-1px); /* 轻微上浮 */
        box-shadow: 0 2px 5px rgba(0, 121, 107, 0.5); /* 外阴影 */
    }
    
    /* NEW: 文章头部信息区深色模式 */
    .post-header-info {
        background-color: var(--color-header-info-bg-dark);
        box-shadow: var(--shadow-dark); 
    }
}
/* E. 全局排版和布局 */
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    line-height: 1.7;
    margin: 0;
    padding: 0;
    background-color: var(--color-background);
    color: var(--color-text);
    transition: background-color 0.3s, color 0.3s;
}

/* NEW COMPONENT STYLES: Header/Navigation Optimization */
header {
    position: sticky;
    top: 0;
    z-index: 1000;
    width: 100%;
    /* 优化建议 1: 启用背景模糊 */
    background-color: rgba(255, 255, 255, 0.95); /* Semi-transparent white */
    -webkit-backdrop-filter: blur(8px); 
    backdrop-filter: blur(8px);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid var(--color-border); 
    border-radius: 0 0 10px 10px; /* 轻微圆角 */
}
header .header-inner {
    max-width: 1100px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 20px;
}
.site-title {
    font-size: 1.5em;
    font-weight: 700;
    color: var(--color-text);
    text-decoration: none;
    white-space: nowrap;
}
nav a {
    text-decoration: none;
    color: var(--color-text);
    font-size: 1.05em;
    font-weight: 500;
    margin-left: 20px;
    padding: 6px 10px;
    border-radius: 6px;
    transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
}
nav a:hover {
    background-color: var(--color-primary-light);
    color: var(--color-primary);
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}
nav a.active-nav-link {
    background-color: var(--color-nav-active-bg-light);
    color: var(--color-nav-active-text-light);
    box-shadow: 0 2px 5px rgba(0, 121, 107, 0.3); /* 提升阴影 */
}
nav a.active-nav-link:hover {
    background-color: var(--color-nav-active-bg-light); /* 悬停时保持颜色 */
    color: var(--color-nav-active-text-light);
}

/* F. 布局和容器 */
main {
    max-width: 1100px;
    margin: 20px auto;
    padding: 0 20px;
}
.content-layout-wrapper {
    display: flex;
    justify-content: space-between;
    gap: 30px;
}
.post-main-content {
    flex-grow: 1;
    min-width: 0; /* 允许 flex item 收缩 */
    max-width: 100%;
}
.card {
    background-color: var(--color-card);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--shadow);
    transition: box-shadow 0.3s;
}
.card:hover {
    box-shadow: var(--shadow-hover);
}

/* G. 链接样式 */
a:link, a:visited {
    color: var(--color-primary);
    text-decoration: none;
    transition: color 0.2s;
}
a:hover {
    color: #004d40; /* 较深的 Primary 色 */
    text-decoration: underline;
}

/* H. 标题样式 */
.post-main-content h1, 
.post-main-content h2, 
.post-main-content h3, 
.post-main-content h4, 
.post-main-content h5, 
.post-main-content h6 {
    color: var(--color-text);
    margin-top: 1.5em;
    margin-bottom: 0.5em;
    padding-top: 5px; /* 顶部留白 */
    line-height: 1.3;
}
.post-main-content h1 {
    font-size: 2.2em;
    border-bottom: 2px solid var(--color-primary-light);
    padding-bottom: 5px;
}
.post-main-content h2 {
    font-size: 1.8em;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 4px;
}
.post-main-content h3 {
    font-size: 1.4em;
}

/* I. 列表和段落 */
.post-main-content p {
    margin-bottom: 1.2em;
}
.post-main-content ul, 
.post-main-content ol {
    padding-left: 25px;
    margin-bottom: 1.2em;
}
.post-main-content li {
    margin-bottom: 0.5em;
}

/* J. 文章内容内的链接样式 (更高优先级) */
.post-content a:link, .post-content a:visited {
    color: var(--color-primary);
    /* 增加下划线，但使用虚线，提高可读性 */
    border-bottom: 1px dotted var(--color-primary); 
    transition: border-color 0.2s, color 0.2s;
}
.post-content a:hover {
    color: #004d40;
    border-bottom: 1px solid #004d40; 
}

/* K. 引用块 (Blockquote) */
.post-content blockquote {
    background-color: var(--color-quote-light);
    border-left: 4px solid var(--color-primary);
    padding: 15px 20px;
    margin: 20px 0;
    color: var(--color-quote-text-light);
    font-style: italic;
    border-radius: 0 4px 4px 0;
}
.post-content blockquote p {
    margin: 0;
}

/* L. 代码块和行内代码 */
.post-content pre {
    background-color: var(--color-code-background);
    padding: 15px;
    border-radius: 6px;
    overflow-x: auto;
    border: 1px solid var(--color-border);
    margin: 20px 0;
}
.post-content pre code {
    background: none !important;
    color: var(--color-text);
    padding: 0;
    font-size: 0.9em;
    line-height: 1.5;
    display: block; /* 确保代码块占据整行 */
}
.post-content code {
    font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
}
.post-content p code, 
.post-content li code {
    background-color: var(--color-inline-code-background);
    color: var(--color-inline-code-text);
    padding: 3px 6px;
    border-radius: 4px;
    white-space: nowrap;
}

/* M. 图像 */
.post-content img {
    max-width: 100%;
    height: auto;
    display: block;
    margin: 20px auto;
    border-radius: 8px;
    box-shadow: var(--shadow);
    transition: box-shadow 0.3s, transform 0.2s;
    border: 1px solid var(--color-border);
    background-color: var(--color-card);
}
.post-content img:hover {
    box-shadow: var(--shadow-hover);
}
.post-content figure {
    margin: 20px 0;
    padding: 0;
    text-align: center;
}
.post-content figcaption {
    font-size: 0.9em;
    color: #888;
    margin-top: 8px;
    transition: color 0.3s;
}

/* N. 分割线 */
.post-content hr {
    border: none;
    border-top: 1px solid var(--color-border); 
    margin: 40px 0;
}

/* O. 表格样式 */
.post-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
    font-size: 0.95em;
    border: 1px solid var(--color-border);
    border-radius: 6px;
    overflow: hidden; /* 确保圆角生效 */
}
.post-content th, 
.post-content td {
    padding: 12px 15px;
    border: 1px solid var(--color-border);
    text-align: left;
}
.post-content th {
    background-color: var(--color-background-light);
    font-weight: 600;
    color: var(--color-text);
}
/* 斑马线效果 */
.post-content tr:nth-child(even) {
    background-color: var(--color-table-stripe-light);
}

/* P. 文章列表和归档页样式 */
.post-list {
    list-style: none;
    padding: 0;
}
.post-item {
    padding: 15px 0;
    border-bottom: 1px solid var(--color-border);
}
.post-item:last-child {
    border-bottom: none;
}
.post-item a.post-title {
    font-size: 1.3em;
    font-weight: 600;
    color: var(--color-text);
    display: block;
    margin-bottom: 5px;
}
.post-item a.post-title:hover {
    color: var(--color-primary);
    text-decoration: none;
}
.post-item .post-excerpt {
    color: #666;
    font-size: 0.95em;
    margin-bottom: 5px;
}
.post-item .post-date {
    font-size: 0.85em;
    color: #999;
}

/* Q. 文章详情页头部信息 */
.post-header-info {
    background-color: var(--color-header-info-bg-light);
    padding: 20px 25px;
    border-radius: 8px;
    margin-bottom: 30px;
    box-shadow: var(--shadow);
    transition: background-color 0.3s, box-shadow 0.3s;
}
.post-header-info h1 {
    border-bottom: none;
    margin-top: 0;
    padding-bottom: 0;
    font-size: 2.2em;
}
.post-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 15px;
    font-size: 0.9em;
    color: #777;
}
.meta-date {
    white-space: nowrap;
}
.meta-tags {
    display: flex;
    align-items: center;
    gap: 8px;
}
.meta-tags-label {
    font-weight: 500;
    color: #555;
}
.tags-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}
/* NEW: 标签徽章样式 */
.tag-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    background-color: var(--color-tag-bg-light);
    color: var(--color-tag-text-light);
    font-size: 0.85em;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s ease;
}
.tag-badge:hover {
    background-color: var(--color-primary);
    color: white;
    text-decoration: none;
    transform: translateY(-1px); 
    box-shadow: 0 2px 5px rgba(0, 121, 107, 0.3);
}

/* R. 目录 (TOC) 侧边栏 */
.toc {
    width: 280px;
    position: sticky;
    top: 80px; /* 放在 Header 下面 */
    align-self: flex-start; /* 粘性定位的关键 */
    padding: 20px;
    border-left: 1px solid var(--color-border);
    max-height: calc(100vh - 100px); /* 限制高度，防止溢出 */
    overflow-y: auto; /* 允许滚动 */
}
.toc-title {
    font-size: 1.2em;
    font-weight: 700;
    margin-bottom: 15px;
    color: var(--color-text);
}
.toc ul {
    list-style: none;
    padding: 0;
    margin: 0;
    line-height: 1.5;
}
.toc ul li {
    margin: 0;
}
.toc a {
    display: block;
    padding: 5px 0;
    color: #666;
    font-size: 0.9em;
    text-decoration: none;
    transition: color 0.2s, background-color 0.2s;
    border-radius: 4px;
}
.toc ul ul {
    padding-left: 15px; /* 子级缩进 */
}
.toc a:hover {
    color: var(--color-primary);
    background-color: var(--color-primary-light);
    text-decoration: none;
}
.toc a.active {
    font-weight: 700;
    color: var(--color-primary);
    background-color: var(--color-toc-active-bg-light);
}

/* S. 页脚样式 */
footer {
    border-top: 1px solid var(--color-border);
    padding: 20px 20px;
    margin-top: 40px;
    background-color: var(--color-background);
    transition: background-color 0.3s;
}
.footer-content {
    max-width: 1100px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    font-size: 0.85em;
    color: #999;
}
.footer-content p {
    margin: 5px 0;
}
.copyright-info a,
.build-info a {
    color: var(--color-primary);
    text-decoration: none;
}
.build-info span {
    color: #aaa;
    transition: color 0.3s;
}
.build-info a:hover,
.copyright-info a:hover {
    text-decoration: underline;
}

/* T. 响应式调整 */
@media (max-width: 900px) {
    /* 侧边栏消失 */
    .toc {
        display: none;
    }
    .content-layout-wrapper {
        flex-direction: column;
    }
}
@media (max-width: 768px) {
    /* 导航栏堆叠 */
    header .header-inner {
        flex-direction: column;
        align-items: flex-start;
    }
    .site-title {
        margin-bottom: 10px;
    }
    nav {
        width: 100%;
        display: flex;
        justify-content: space-around;
        gap: 0;
    }
    nav a {
        margin: 0;
        flex-grow: 1;
        text-align: center;
    }
    main {
        margin: 10px auto;
        padding: 0 15px;
    }
    .footer-content {
        flex-direction: column;
        align-items: center;
    }
    .footer-content p {
        text-align: center;
    }
    /* 详情页 meta 信息也堆叠 */
    .post-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
    }
}
